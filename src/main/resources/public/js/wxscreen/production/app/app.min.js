!function (t) {
    if (!t.app) {
        var i = t.app = {_appList: {}, _appInited: {}, _readyList: {}, _reSendList: {}, _currId: null};
        i.init = function () {
        }, i.reg = function (i, e) {
            return this._appList[i] ? (t.log("app.reg: app exists"), void 0) : (this._appList[i] = e, this.initApp(i), void 0)
        }, i.initApp = function (e) {
            if (!this._appInited[e]) {
                var n = this._appList[e], s = t.getConf("keyCodeMap")[n.shortcut];
                if (s ? (t.sub("key." + s + ".down", function () {
                        $("#" + e + ":visible").length ? i.hide() : i.show(e)
                    }), t.sub("key." + n.shortcut + ".down, key." + n.shortcut.toLowerCase() + ".down", function () {
                        $("#" + e + ":visible").length ? i.hide() : i.show(e)
                    })) : t.log("app.initApp keycode empty: ", n.shortcut), t.sub("key.27.down", function () {
                        i._currId && i.hide()
                    }), n.listenAPI)for (var r = 0; r < n.listenAPI.length; r++)t.sub(n.listenAPI[r], function (t, n) {
                    i.send(e, t, n)
                });
                this._appInited[e] = !0
            }
        }, i.show = function (i) {
            this._currId && this._currId != i && this.hide();
            var e = $("#" + i);
            e.length && ($("#wrap").hide(), e.show(), this._currId = i, this.send(i, "show")), t.setState("app"), t.message.pull()
        }, i.on = function () {
            t.message.off(!0)
        }, i.off = function () {
        }, i.hide = function () {
            this._currId && ($("#" + this._currId).hide(), this.send(this._currId, "hide"), this._currId = null), $("#wrap").show(), t.setState("message")
        }, i.getConf = function (t) {
            return this._appList[t]
        }, i.getCurrentId = function () {
            return this._currId
        }, i.send = function (i, e, n) {
            if (!this._readyList[i])return this._reSendList[i] || (this._reSendList[i] = []), this._reSendList[i].push({
                evt: e,
                data: n
            }), this._reSendList[i].length > 20 && this._reSendList[i].splice(0, this._reSendList[i].length - 20), void 0;
            var s = window.frames[i];
            return s && s.APP ? (s.APP.trigger(e, n), 2) : (t.pub(i + "." + e, n), 1)
        }, i.ready = function (t) {
            this._readyList[t] = !0, this.reSend(t)
        }, i.reSend = function (t) {
            var i = this._reSendList[t];
            if (i && i.length)for (var e = 0; e < i.length; e++)this.send(t, i[e].evt, i[e].data)
        }
    }
}(wxscreen);